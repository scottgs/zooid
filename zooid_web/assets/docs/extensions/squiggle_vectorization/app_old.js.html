<!DOCTYPE html>
<html>
  <head>
    <title>extensions</title>
    <!-- Viewport mobile tag for sensible mobile support-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="/styles/bootstrap.min.css" rel="stylesheet">
    <link href="/styles/font-awesome.min.css" rel="stylesheet">
    <link href="/styles/iconic.min.css" rel="stylesheet">
    <link href="/styles/buttons.css" rel="stylesheet">
    <link href="/styles/animate.css" rel="stylesheet">
    <link href="/styles/dropzone.css" rel="stylesheet">
    <link href="/styles/todc-bootstrap.min.css" rel="stylesheet">
    <link href="/styles/webui-popover.css" rel="stylesheet">
    <link href="//www.fuelcdn.com/fuelux/3.2.1/css/fuelux.min.css" rel="stylesheet">
    <link href="/styles/zooid.css" rel="stylesheet">
    
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery_custom.js"></script>
    <script src="/js/dependencies/sails.io.js"></script>
    <script src="/js/webui-popover.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/buttons.js"></script>
    <script src="/js/ripples.min.js"></script>
    
    <div class="container">
      <div style="margin-bottom:36px!important;">
        <div role="navigation" style="padding-bottom:8px;padding-top:8px;" class="navbar navbar-fixed-top navbar-default">
          <div class="container">
            <div class="navbar-header">
              <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span>
                <fa class="fa fa-fw fa-caret-down"></fa>
              </button><a href="/" style="margin-top:0px" class="navbar-brand">
                <o>Zooid</o></a>
            </div>
            <div class="navbar-collapse collapse scootRight"> 
              <ul class="nav navbar-nav navbar-left">
                <li><a href="/cbir">
                    <div class="fa fa-fw ion-image fa-"></div>
                    <oo>cbir</oo></a></li>
                <li><a href="/z">
                    <div class="fa fa-fw fa-cloud fa-"></div>
                    <oo>zodes</oo></a></li>
                <li><a href="/s">
                    <div class="fa fa-fw fa-bar-chart fa-"></div>
                    <oo>signals</oo></a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/s">
                    <fa class="fa fa-fw fa-github-square fa-"></fa>
                    <oo>github</oo></a></li>
                <li class="dropdown scootLeft"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><i class="fa fa-fw ion-ios7-browsers fa-"></i>
                    <oo>docs<i class="fa fa-fw ion-arrow-down-b"></i></oo>
                    <ul role="menu" style="min-width:220px;" class="dropdown-menu">
                      <li><a href="/docs/web">
                          <oo>Web app</oo></a></li>
                      <li><a href="/docs/core">
                          <oo>Core</oo></a></li>
                      <li><a href="/docs/extensions">
                          <oo>Extensions</oo></a></li>
                      <li class="divider"></li>
                      <li><a href="/regenerate">
                          <oo>Regenerate all</oo></a></li>
                    </ul></a></li>
              </ul>
            </div>
          </div>
        </div>
        <hr>
      </div>
    </div>
    <noscript>Please enable JavaScript and refresh this page</noscript>
  </head>
</html>
<head>
  <meta name="viewport" content="width=device-width" charset="utf-8">
  <title>extensions</title>
  <script type="text/javascript" src="/js/prefixfree.js"></script>
</head>
<body data-spy="scroll" data-target=".scrollspy">
  <div class="container">
    <div class="container">
      <div class="col-md-4 bs-docs-sidebar panel-body">
        <h4 class="text-blue">extensions docs</h4>
        <ul class="nav nav-list bs-docs-sidenav affix-top">
          <li><a href="../index.html">Main</a></li>
          <li><a href="../app.js.html">app.js</a></li>
          <li><a href="../color_histogram/app.js.html">color_histogram/app.js</a></li>
          <li><a href="../directory_consumption/app.js.html">directory_consumption/app.js</a></li>
          <li><a href="../ext.js.html">ext.js</a></li>
          <li><a href="../face_blurring/app.js.html">face_blurring/app.js</a></li>
          <li><a href="../face_detection/app.js.html">face_detection/app.js</a></li>
          <li><a href="../geo_conversion/app.js.html">geo_conversion/app.js</a></li>
          <li><a href="../image_consumption/app.js.html">image_consumption/app.js</a></li>
          <li><a href="../nearest_neighbor/app.js.html">nearest_neighbor/app.js</a></li>
          <li><a href="../robots_in_disguise/app.js.html">robots_in_disguise/app.js</a></li>
          <li><a href="../signal_classification/app.js.html">signal_classification/app.js</a></li>
          <li><a href="../squiggle_vectorization/app.js.html">squiggle_vectorization/app.js</a></li>
          <li class="active"><a href="../squiggle_vectorization/app_old.js.html">squiggle_vectorization/app_old.js</a></li>
          <li><a href="../squiggle_vectorization/index.js.html">squiggle_vectorization/index.js</a></li>
          <li><a href="../terrain_geolocation/app.js.html">terrain_geolocation/app.js</a></li>
          <li><a href="../terrain_geolocation/run.js.html">terrain_geolocation/run.js</a></li>
          <li><a href="../terrain_geolocation/terrain_geolocator.js.html">terrain_geolocation/terrain_geolocator.js</a></li>
          <li><a href="../terrain_geolocation/worker.js.html">terrain_geolocation/worker.js</a></li>
          <li><a href="../text_scraping/app.js.html">text_scraping/app.js</a></li>
          <li><a href="../vehicle_detection/app.js.html">vehicle_detection/app.js</a></li>
        </ul>
        <div class="scrollspy">
          <ul class="nav nav-list bs-docs-sidenav right affix-top">
            <li class="little"><a href="#exports"><span>
                  <fa class=" fa fa-sm fa-fw  fa-caret-right"></fa></span><span>exports</span></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-7 docs-main">
        <h3>squiggle_vectorization/app_old.js</h3><br>
        <section id="exports">
          <h3>exports
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>module.exports()</span>
            </p></h3>
        </section>
        <div class="description"> </div>
        <pre><code class="language-javascript">module.exports = function(collective){


   collective.on(&quot;terrain_silhouette&quot;, function(signal){

      getSignatureFromPoints(signal.points, function(err, signature){
         var new_signal = {}
         new_signal.parent_id = signal.id
         new_signal.signature = signature
         collective.emit(&quot;terrain_silhouette_signature&quot;, new_signal)
      })
   })


   collective.on(&quot;test&quot;, function(){
      var signal = {}
      signal.points = [
              {x:0,y:11}, {x:1, y:13}, {x:2, y:15}, {x:3, y:111}, {x:4, y:19}, {x:5, y:17}, {x:6, y:17}
            , {x:7, y:17}, {x:8, y:17}, {x:9, y:11}, {x:10, y:13}, {x:11, y:15}, {x:12, y:111}, {x:13, y:19}
            , {x:14, y:17}, {x:15, y:17}, {x:16, y:17}, {x:17, y:17}, {x:18, y:111}, {x:19, y:115}, {x:20, y:111}
            , {x:21, y:119}, {x:22, y:17}, {x:23, y:117}, {x:24, y:117}, {x:25, y:113}, {x:26, y:115}, {x:27, y:111}
            , {x:28, y:19}, {x:29, y:117}, {x:30, y:117}, {x:31, y:117}, {x:32, y:17}, {x:33, y:11}, {x:34, y:13}, {x:35, y:17}
            , {x:36, y:19}, {x:37, y:117}, {x:30, y:117}, {x:38, y:117}, {x:39, y:7}, {x:40, y:1}, {x:41, y:3}, {x:42, y:7}
      ];
      getSignatureFromPoints( signal.points, function(err, silhouette_signature){
         console.log(&quot;TEST PASSED:&quot;, &quot;terrain_silhouette&quot;);
         // console.log(silhouette_signature)
      })
   })

}



var _ = require(&quot;underscore&quot;);
var async= require(&quot;async&quot;);

var demo = function(ar){
   var ii=3; while(ii-- &gt; 1) console.log(ar[ii]);
   return 1
}

var err = null
var config = {};

// Sorts on x values
xort = function(a,b) {
   if (a.x &lt; b.x) return -1;
   if (a.x &gt; b.x)return 1
   return 0
}

var normalize = function( signature, next ){
   
   // console.log(&quot;normalize&quot;)
   // demo(signature)

   var merged = [];
   if (signature instanceof Array) {
      if (signature[0] instanceof Array) {
         squiggleCount = signature.length;
         merged = merged.concat.apply(merged, signature);
      } else {
         merged = [signature]
         squiggleCount = 1;
      }
   } else {
      next( &quot;Error: Must send signature or arrays of signature.&quot; );
   }  
   next( null, merged )
}


var downSample = function( points, next ){
   // console.log(&quot;downSample&quot;)
   // demo(points)
   if(points.length &lt; 4 * 5 ) next( err, points)
   points.sort( xort );
   var i
   var len = points.length
   var ds_coef = Math.ceil( len/1500 )
   var points_ds = [];
   var num_points = points.length;
   // var ds = ds_coef * (config['sampleRate'] || 4);
   var ds = 4;
   // get representation of entire squiggle
   for (i=0; i&lt;points.length; i += ds) {
      points_ds.push(points[i]);
   }
   next( err, points_ds );
}



// todo: hard tanh ( piecewise linear )



// Compute the vector angles from the point array (AND FLIP)
// NOTE: The points are using y positive in the down direction
// which is incorrect, so logically, I &quot;flip&quot; the points
var computeVectorAnglesFromPoints = function ( points, next ) {
   // console.log(&quot;computeVectorAnglesFromPoints&quot;)
   // demo(points)

   vector_angles = [];
   for (var i=0; i&lt;points.length -1; i+=1) {       
      var ang = Math.atan2(points[i]['y']-points[i+1]['y'], points[i+1]['x']-points[i]['x']);
      vector_angles.push(ang);
   }
   next( null, vector_angles);
}

// Compute the signature from vector angles
var computeSignatureFromVectorAngles = function (vector_angles, next ) {
   // console.log(&quot;computeSignatureFromVectorAngles&quot;)
   // demo(vector_angles)

   var signature = [];
   for (i=0; i &lt; vector_angles.length -1; i++) {
      signature[i] = Math.sin((vector_angles[i+1] - vector_angles[i]) / 2);
   }
   next( null, signature);
}




var splitEvenly = function(a, n, next) {
   // console.log(&quot;splitEvenly&quot;)
   // demo(a)
   var len = a.length; var out = []; var i = 0;
   while (i &lt; len) {
      var size = Math.ceil((len - i) / n--);
      var halfStep = Math.floor(size*0.5);
      out.push( a.slice(i, i += size));
      out.push( a.slice( (i-halfStep), (i+halfStep) ));
   }
   next( null, out );
}


var splitByVariance = function(a, next){
   // console.log(&quot;splitByVariance&quot;)
   // demo(a)

   var varianceThreshold = 4;

   var totsVariance = _.reduce( a, function(memo, num){ return Math.abs(memo) + Math.abs(num); }, 0);
   console.log(&quot;total variance&quot;);
   console.log(totsVariance);
   var len = a.length, out = [], i = 0, last = 0, variance = 0;
   for(i=0; i&lt;len; i++) {
      if( Math.abs( variance += a[i] ) &gt; ( totsVariance / varianceThreshold) || i-last &gt; len / varianceThreshold){
         out.push( a.slice( last, i ) );
         last = i;
         console.log(&quot;variance&quot;, variance);
         variance=0;
      }
   }
   out.push( a.slice( last-20, a.length ) )
   out.push( a.slice( last, a.length ) )
   next( err,  out )
}




var isolatePartsByVariance = function( signature, next ){
   // console.log(&quot;isolatePartsByVariance&quot;)
   // demo(signature)

   var minChop             = config['minSplitFactor'] || 1
   var maxChop             = config['maxSplitFactor'] || 2
   var varianceThreshold   = 5

   if( (signature.length / varianceThreshold) &lt; 10 )
      next( err, signature)
   // var varianceThreshold   = config['varianceThreshold'] || 2
   var isolatedParts = [];
   downSample( signature, function(ds){ isolatedParts.push( ds.join() ); }, Math.ceil(signature.length/24) );
   splitByVariance( signature, varianceThreshold, function(parts){
      for (var j = parts.length - 1; j &gt;= 0; j--) {
         isolatedParts.push( parts[j] );
      };
   })
   next( err, isolatedParts);

}




var isArray = function (obj) {
   return Object.prototype.toString.call(obj) === &quot;[object Array]&quot;;
}
var getNumWithSetDec = function( num, numOfDec ){
   var pow10s = Math.pow( 10, numOfDec || 0 );
   return ( numOfDec ) ? Math.round( pow10s * num ) / pow10s : num;
}
var getAverageFromNumArr = function( numArr, numOfDec ){
   if( !isArray( numArr ) ){ return false;   }
   var i = numArr.length, 
      sum = 0;
   while( i-- ){
      sum += numArr[ i ];
   }
   return getNumWithSetDec( (sum / numArr.length ), numOfDec );
}
var getVariance = function( numArr, numOfDec ){
   if( !isArray(numArr) ){ return false; }
   var avg = getAverageFromNumArr( numArr, numOfDec ), 
      i = numArr.length,
      v = 0;
 
   while( i-- ){
      v += Math.pow( (numArr[ i ] - avg), 2 );
   }
   v /= numArr.length;
   return getNumWithSetDec( v, numOfDec );
}
var getStandardDeviation = function( numArr, numOfDec ){
   if( !isArray(numArr) ){ return false; }
   var stdDev = Math.sqrt( getVariance( numArr, numOfDec ) );
   // console.log(stdDev);
   return stdDev
};


var getBest = function(signature, next){
   
   // console.log(&quot;getBest&quot;)
   // demo(signature)
   var n = 10

   // console.log(&quot;GETTING BEST: &quot;, n);
   if(signature.length &lt;= 5)  next( err, signature);
   var deviations = []
   var results = []
   for (var p = n; p &gt;= 0; p--){
      deviations[p]=0;
   }

   for (var i = signature.length - 1; i &gt;= 0; i--) {
      var s = getStandardDeviation(signature[i], 5);
      console.log(s)
      for (var j = deviations.length - 1; j &gt;= 0; j--) {
         if(deviations[j] &lt; s){
            console.log(deviations[j], &quot; &lt; &quot;, s)
            deviations[j] = s;
            results[j] = signature[i];
            break;
         }
      };
   };

   for (var r = results.length - 1; r &gt;= 0; r--) {
      // console.log(&quot;TESTING: &quot;, results[r])
      if( !!results[r] &amp;&amp; results[r].length &lt; 5 ){
         results.splice(r,1);
      }
   };
   next( null, results);

}



var stringifyParts = function( parts, next ){
   // console.log(&quot;stringifyParts&quot;)
   // demo(parts)
   
   var stringifiedParts = [];
   for (var i = parts.length - 1; i &gt;= 0; i--) {
      stringifiedParts.push( parts[i].join() );
   };
   next( null, stringifiedParts)
}

var fibSplit = function(arr, next){
   // console.log(&quot;fibSplit&quot;)
   // demo(arr)
   
   var split_counts = [1, 2, 3, 5, 8, 13, 21]

   var split_parts = [];

   for(var i = split_counts.length - 1; i &gt;= 0; i--) {

      splitEvenly( arr, split_counts[i], function(err, parts) {
         _.each(parts, function(part){split_parts.push(part); } );

         // console.log(&quot;Parts: &quot;, i, split_counts[i], parts.length )
      });
   };

   // console.log(&quot;Finished Fib Split:&quot;, split_parts);
   next( null, split_parts);
}


function getElite( split_parts, next ){
   // console.log(&quot;getElite&quot;)
   // demo(split_parts)
   
   var filtered_parts = _.filter(split_parts, function(part){ return part.length &gt; 4 })

   // console.log(&quot;Sorting by Standard devation over length &quot;, filtered_parts.length)

   // _.each( filtered_parts, function(part) { console.log(&quot;Not sorted:&quot;, part.length); })

   var sorted_by_deviation = _.sortBy(filtered_parts, function(part){ return -(getStandardDeviation(part)); })

   // _.each(sorted_by_deviation, function(part) { console.log(&quot;Sorted by standard devation&quot;, part.length); })
   var best_by_deviation = _.first(sorted_by_deviation, 15);
   var sorted_by_length = _.sortBy(best_by_deviation, function(part){ return -part.length })
   
   // _.each(sorted_by_length, function(part) { console.log(&quot;Sorted by lebgth&quot;, part.length); })
   var best_by_length_and_deviation = _.first(sorted_by_length, 4)
   // console.log(&quot;elite:&quot;, best_by_length_and_deviation.length);

   next( null, best_by_length_and_deviation);

}



function getSignatureFromPoints( points, next ){
   // console.log(&quot;getSignatureFromPoints&quot;)
   // demo(points)

   var dispatch = async.compose( getElite, fibSplit, computeSignatureFromVectorAngles, computeVectorAnglesFromPoints, downSample );

   dispatch( points, function(err, signature){
      // console.log( err || signature );
      next( err, signature );
   })

}


         // normalize([points], function(err, normalized_path) {
         //    console.log(&quot;normalized&quot;, normalized_path.length);
            
         //    demo(normalized_path)

         //    if(normalized_path.length &lt; 12) next();

         //    downSample(normalized_path, function(err, ds_path, ws_path){

         //       console.log(&quot;ds_path&quot;, ds_path.length);
         //       demo(ds_path)

         //       computeVectorAnglesFromPoints( ds_path, function(err, vector_angles){

         //          console.log(&quot;vector_angles&quot;, vector_angles.length);
         //          demo(vector_angles);
                  
         //          computeSignatureFromVectorAngles( vector_angles, function(err, points){

         //             console.log(&quot;points&quot;, points.length);
         //             demo(points);


         //             fibSplit(points, function(err, split_parts){

         //                getElite(split_parts, function(err, best_by_length_and_deviation){
         //                   next( err, best_by_length_and_deviation);
         //                })
         //             })
         //          }) 
         //       })
         //    })
         // })




// PHP IMPORT


// //Compare utility
// __cmp_utility = function (a, b) { return(a[&quot;utility&quot;] &lt; b[&quot;utility&quot;]); }

//    //CALL THIS FUNCTION TO COMPUTE THE SIGNATURE WITH AN ARRAY
//    //OF POINTS SEPERATED IN FORMAT array(x0, y0, x1, y1, x2, y2, ... , xn, yn)
//    signature = function (split_points, window_size, window_step_size) {
//       error = &quot;&quot;;
      
//       total = count(split_points);
//       if (total % 2 == 1 || total == 0) error = buildError(&quot;There must be an even number of argumets in the format: window_size/window_step_size/x0/y0/x1/y1/...&quot;);
//       if (window_size == 0) error = buildError(&quot;First argument \&quot;window_size\&quot; must not equal 0&quot;);
//       if (window_step_size == 0) error = buildError(&quot;Second argument \&quot;window_step_size\&quot; must not equal 0&quot;);
//       if (!empty(error)) { echo(error); return; }
      
//       //Get the array by merging the seperated array format to an array of points
//       points = this-&gt;convertSeqToPointArray(split_points);
      
//       //Get the various signatures using different sample rates
//       raw_signature = this-&gt;__signature(points, window_size, window_step_size);
      
//       //Grab interpolated &amp; nearest neighbor
//       interpolated = this-&gt;buildDownsampledArray(points, array(3), 1, window_size, window_step_size);
//       nearest = this-&gt;buildDownsampledArray(points, array(3), 0, window_size, window_step_size);
      
//       //Extract the most useful signatures
//       useful = array();
//       useful = array_merge(useful, array_slice(this-&gt;mostUsefulSignatures(interpolated), 0, 5));
//       useful = array_merge(useful, array_slice(this-&gt;mostUsefulSignatures(nearest), 0, 5));
      
//       //Sort the result and slice
//       //usort(useful, &quot;__cmp_utility&quot;);
//       //useful = array_slice(useful, 0, 5);
      
//       //Get the result
//       result = array(&quot;args&quot; =&gt; json_encode(points), &quot;success&quot; =&gt; true, &quot;data&quot; =&gt; array('raw' =&gt; raw_signature, 'interpolated' =&gt; interpolated, 'nearest' =&gt; nearest, 'useful' =&gt; useful));
//       echo (json_encode(result));
//    }
   
//    //This returns signature with the utility and signature
//    __signature = function (points, window_size, window_step_size, extra=array()) {
//       //Compute the signatures
//       sigs = this-&gt;computeSigFromPoints(points, window_size, window_step_size);
      
//       //Go through each signature and add the utility and extra data
//       for (i=0; i&lt;count(sigs); i++) { 
//          sigs[i][&quot;utility&quot;] = this-&gt;L1norm(sigs[i][&quot;signature&quot;]);
//          if (!empty(extra)) sigs[i][&quot;extra&quot;] = extra;
//       }
      
//       //Sort based on utility
//       usort(sigs, &quot;__cmp_utility&quot;);
      
//       //Return the modified signatures
//       return(sigs);
//    }
   
//    buildError = function (err_message) {
//       return(json_encode(array(&quot;success&quot; =&gt; false, &quot;message&quot; =&gt; err_message, &quot;data&quot; =&gt; array())));
//    }
   
//    //Get most useful signatures
//    mostUsefulSignatures = function (signature) {
//       merged_array = array();
//       foreach(signature as sig_set) { merged_array = array_merge(merged_array, sig_set); }
//       usort(merged_array, &quot;__cmp_utility&quot;);
//       return(merged_array);
//    }
   
//    //L1-norm
//    L1norm = function (signature) {
//       sum = 0;
//       foreach(signature as val) { sum += abs(val); }
//       return(sum);
//    }
   
//    //Build a downsampled array
//     buildDownsampledArray = function (points, factors, method, window_size, window_step_size) {
//       downsample = array();
//       method_type = array(0 =&gt; 'nearest neighbor', 1 =&gt; 'interpolated', 2 =&gt; 'interpolated');
//       extra = array('type' =&gt; method_type[method]);
      
//       //Loop through and build the array based on factors
//       foreach(factors as factor) { 
//          extra['factor'] = factor;
//          downsample[factor] = this-&gt;__signature(this-&gt;downsamplePoints(points, factor, method), window_size, window_step_size, extra);
//       }
      
//       return(downsample);
//    }
   
//    //Windowing code for monolithic point array
//     windowPoints = function (points, window_size, window_step_size) {
//       adj_window_size = window_size + 1;
//       windows = array();
      
//       //Get the total number of points and windows
//       num_points = count(points);
//       num_windows = ceil((num_points-window_size) / window_step_size);
      
//       for (w=0; w&lt;num_windows; w++) {
//          //Get the overflow from the end
//          diff = w*window_step_size+adj_window_size - num_points;
         
//          //Initialize the slice array
//          slice = array();
         
//          //If the difference is positive or zero, then there is no overlap
//          if (diff &lt;= 0) {
//             slice = array_slice(points, w*window_step_size, adj_window_size);
//          }
         
//          //Add the slice to the end of the windows
//          windows[] = slice;
//       }
      
//       return(windows);
//    }
   
//    //Compute the signature from the monolithic array
//     computeSigFromPoints = function (points, window_size, window_step_size) {
//       window_points = this-&gt;windowPoints(points, window_size, window_step_size);
//       signatures = array();
      
//       //Go through each window and compute their signature
//       foreach(window_points as ptwin) {
//          vector_angles = this-&gt;computeVectorAnglesFromPoints(ptwin);
//          signatures[] = array(&quot;points&quot; =&gt; ptwin, &quot;signature&quot; =&gt; this-&gt;computeSignatureFromVectorAngles(vector_angles));
//       }
      
//       //Return the signatures organized by points and their respective signatures
//       return(signatures);
//    }

//    //Convert the sequence to points and flip
//     convertSeqToPointArray = function (split_points) {
//       points = array();
//       for (i=0; i&lt;count(split_points); i+=2) {
//          points[] = array('x' =&gt; floatval(split_points[i]), 'y' =&gt; floatval(split_points[i+1]));
//       }
//       return(points);
//    }
   

   
//    //Returns a trimmed array removing values from an array
//    // front - the number of values to remove from the front of the array
//    // back - the nubmer of values to remove from the back of the array
//    trimArray = function (array, front, back) {
//       return(array_slice(array, front, -back));
//    }
   
//    //Downsample using interpolation
//    // type:
//    // 0 - Nearest Neighbor
//    // 1 - Interpolated
//    // 2 - Interpolated By Domain
//    
//    downsamplePoints = function (points, ds, type = 1) {
//       //Protect against invalid downsampling
//       if (ds &lt;= 2) return(points);
//       if (ds == 2) return(this-&gt;downsampleByDomain(points, ds));

//       //Create the return and number of points
//       points_ds = array();
//       num_points = count(points);
      
//       //Loop through and perform downsampling
//       for (i=0; i&lt;count(points); i += ds) {
//          remaining_points = num_points - i;
         
//          ds_val = 1;
//          if (type == 1) ds_val = min(remaining_points, ds);
//          points_ds[] = array('x' =&gt; points[i]['x']/ds_val, 'y' =&gt; points[i]['y']/ds_val);
         
//          cp = count(points_ds)-1;
//          for (j=1; j&lt;ds_val; j++) {
//             points_ds[cp]['x'] += points[i+j]['x']/ds_val;
//             points_ds[cp]['y'] += points[i+j]['y']/ds_val;
//          }
//       }
      
//       //Return the downsampled
//       return(points_ds);
//    }

//    //Downsample using modified interpolation
//    downsampleByDomain = function (points, ds)
//    {
//       points_ds = array();
//       num_points = count(points);

//       for (i=0; i&lt;count(points); i += ds) {
//          points_ds[] = array('x' =&gt; points[i]['x'], 'y' =&gt; points[i]['y']);
//          cp = count(points_ds)-1;
         
//          j=1;
//          for (;;j++) {
//             if (i+j &gt;= num_points &amp;&amp; abs(points[i+j]['x']-points[i]['x']) &lt; ds) {
//                points_ds[cp]['y'] += points[i+j]['y'];
//             } else {
//                j--;
//                break;
//             }
//          }

//          points_ds[cp]['y'] /= j;
//       }

//       return(points_ds);
//    }
// }</code></pre>
      </div>
    </div>
  </div><br><br><br>
  <footer class="footer">
    <div class="container"><small>Author: Ben Baker 2014</small></div>
  </footer>
  
  
  <script>
    //- /**
    //-  * Prism: Lightweight, robust, elegant syntax highlighting
    //-  * MIT license http://www.opensource.org/licenses/mit-license.php/
    //-  * @author Lea Verou http://lea.verou.me
    (function(){var e=/\blang(?:uage)?-(?!\*)(\w+)\b/i,t=self.Prism={util:{type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},clone:function(e){var n=t.util.type(e);switch(n){case"Object":var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=t.util.clone(e[i]));return r;case"Array":return e.slice()}return e}},languages:{extend:function(e,n){var r=t.util.clone(t.languages[e]);for(var i in n)r[i]=n[i];return r},insertBefore:function(e,n,r,i){i=i||t.languages;var s=i[e],o={};for(var u in s)if(s.hasOwnProperty(u)){if(u==n)for(var a in r)r.hasOwnProperty(a)&&(o[a]=r[a]);o[u]=s[u]}return i[e]=o},DFS:function(e,n){for(var r in e){n.call(e,r,e[r]);t.util.type(e)==="Object"&&t.languages.DFS(e[r],n)}}},highlightAll:function(e,n){var r=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code');for(var i=0,s;s=r[i++];)t.highlightElement(s,e===!0,n)},highlightElement:function(r,i,s){var o,u,a=r;while(a&&!e.test(a.className))a=a.parentNode;if(a){o=(a.className.match(e)||[,""])[1];u=t.languages[o]}if(!u)return;r.className=r.className.replace(e,"").replace(/\s+/g," ")+" language-"+o;a=r.parentNode;/pre/i.test(a.nodeName)&&(a.className=a.className.replace(e,"").replace(/\s+/g," ")+" language-"+o);var f=r.textContent;if(!f)return;f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g," ");var l={element:r,language:o,grammar:u,code:f};t.hooks.run("before-highlight",l);if(i&&self.Worker){var c=new Worker(t.filename);c.onmessage=function(e){l.highlightedCode=n.stringify(JSON.parse(e.data));l.element.innerHTML=l.highlightedCode;s&&s.call(l.element);t.hooks.run("after-highlight",l)};c.postMessage(JSON.stringify({language:l.language,code:l.code}))}else{l.highlightedCode=t.highlight(l.code,l.grammar);l.element.innerHTML=l.highlightedCode;s&&s.call(r);t.hooks.run("after-highlight",l)}},highlight:function(e,r){return n.stringify(t.tokenize(e,r))},tokenize:function(e,n){var r=t.Token,i=[e],s=n.rest;if(s){for(var o in s)n[o]=s[o];delete n.rest}e:for(var o in n){if(!n.hasOwnProperty(o)||!n[o])continue;var u=n[o],a=u.inside,f=!!u.lookbehind||0;u=u.pattern||u;for(var l=0;l<i.length;l++){var c=i[l];if(i.length>e.length)break e;if(c instanceof r)continue;u.lastIndex=0;var h=u.exec(c);if(h){f&&(f=h[1].length);var p=h.index-1+f,h=h[0].slice(f),d=h.length,v=p+d,m=c.slice(0,p+1),g=c.slice(v+1),y=[l,1];m&&y.push(m);var b=new r(o,a?t.tokenize(h,a):h);y.push(b);g&&y.push(g);Array.prototype.splice.apply(i,y)}}}return i},hooks:{all:{},add:function(e,n){var r=t.hooks.all;r[e]=r[e]||[];r[e].push(n)},run:function(e,n){var r=t.hooks.all[e];if(!r||!r.length)return;for(var i=0,s;s=r[i++];)s(n)}}},n=t.Token=function(e,t){this.type=e;this.content=t};n.stringify=function(e){if(typeof e=="string")return e;if(Object.prototype.toString.call(e)=="[object Array]"){for(var r=0;r<e.length;r++)e[r]=n.stringify(e[r]);return e.join("")}var i={type:e.type,content:n.stringify(e.content),tag:"span",classes:["token",e.type],attributes:{}};i.type=="comment"&&(i.attributes.spellcheck="true");t.hooks.run("wrap",i);var s="";for(var o in i.attributes)s+=o+'="'+(i.attributes[o]||"")+'"';return"<"+i.tag+' class="'+i.classes.join(" ")+'" '+s+">"+i.content+"</"+i.tag+">"};if(!self.document){self.addEventListener("message",function(e){var n=JSON.parse(e.data),r=n.language,i=n.code;self.postMessage(JSON.stringify(t.tokenize(i,t.languages[r])));self.close()},!1);return}var r=document.getElementsByTagName("script");r=r[r.length-1];if(r){t.filename=r.src;document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",t.highlightAll)}})();;
    Prism.languages.markup={comment:/&lt;!--[\w\W]*?--(&gt;|&gt;)/g,prolog:/&lt;\?.+?\?&gt;/,doctype:/&lt;!DOCTYPE.+?&gt;/,cdata:/&lt;!\[CDATA\[[\w\W]+?]]&gt;/i,tag:{pattern:/&lt;\/?[\w:-]+\s*(?:\s+[\w:-]+(?:=(?:("|')(\\?[\w\W])*?\1|\w+))?\s*)*\/?&gt;/gi,inside:{tag:{pattern:/^&lt;\/?[\w:-]+/i,inside:{punctuation:/^&lt;\/?/,namespace:/^[\w-]+?:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/gi,inside:{punctuation:/=|&gt;|"/g}},punctuation:/\/?&gt;/g,"attr-name":{pattern:/[\w:-]+/g,inside:{namespace:/^[\w-]+?:/}}}},entity:/&amp;#?[\da-z]{1,8};/gi};Prism.hooks.add("wrap",function(e){e.type==="entity"&&(e.attributes.title=e.content.replace(/&amp;/,"&"))});;
    Prism.languages.css={comment:/\/\*[\w\W]*?\*\//g,atrule:/@[\w-]+?(\s+[^;{]+)?(?=\s*{|\s*;)/gi,url:/url\((["']?).*?\1\)/gi,selector:/[^\{\}\s][^\{\}]*(?=\s*\{)/g,property:/(\b|\B)[a-z-]+(?=\s*:)/ig,string:/("|')(\\?.)*?\1/g,important:/\B!important\b/gi,ignore:/&(lt|gt|amp);/gi,punctuation:/[\{\};:]/g};Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{style:{pattern:/(&lt;|<)style[\w\W]*?(>|&gt;)[\w\W]*?(&lt;|<)\/style(>|&gt;)/ig,inside:{tag:{pattern:/(&lt;|<)style[\w\W]*?(>|&gt;)|(&lt;|<)\/style(>|&gt;)/ig,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.css}}});;
    Prism.languages.clike={comment:{pattern:/(^|[^\\])(\/\*[\w\W]*?\*\/|\/\/.*?(\r?\n|$))/g,lookbehind:!0},string:/("|')(\\?.)*?\1/g,keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|catch|finally|null|break|continue)\b/g,"boolean":/\b(true|false)\b/g,number:/\b-?(0x)?\d*\.?[\da-f]+\b/g,operator:/[-+]{1,2}|!|=?&lt;|=?&gt;|={1,2}|(&amp;){1,2}|\|?\||\?|\*|\//g,ignore:/&(lt|gt|amp);/gi,punctuation:/[{}[\];(),.:]/g};;
    Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(var|let|if|else|while|do|for|return|in|instanceof|function|new|with|typeof|try|catch|finally|null|break|continue)\b/g,number:/\b(-?(0x)?\d*\.?[\da-f]+|NaN|-?Infinity)\b/g});Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/g,lookbehind:!0}});Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(&lt;|<)script[\w\W]*?(>|&gt;)[\w\W]*?(&lt;|<)\/script(>|&gt;)/ig,inside:{tag:{pattern:/(&lt;|<)script[\w\W]*?(>|&gt;)|(&lt;|<)\/script(>|&gt;)/ig,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.javascript}}});;
    
  </script>
  <script>
    $(function(){
      var $window = $(window);
      $('.scrollspy .nav').affix({
        offset: {
          top: function () { return $window.width() <= 980 ? 20 : 20 }
        , bottom: 50
        }
      });
    })
  </script>
</body>